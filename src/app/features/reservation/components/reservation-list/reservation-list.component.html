<section [ngClass]="{ 'p-8 bg-gray-100 min-h-screen': !listOfDetailsField }">
  <div class="max-w-6xl mx-auto space-y-8">
    @if (!listOfDetailsField) {
    <div class="bg-white p-6 rounded-xl shadow-md">
      <h1 class="text-3xl font-bold text-primary">Tus reservas</h1>
      <p class="text-gray-600 mt-2">
        Aquí puedes ver todas tus reservas ordenadas a más recientes.
      </p>
    </div>
    @if (isReservationTeam()) {
    <div class="w-full md:w-60">
      <button-action text="Hacer reserva" color="primary" (clicked)="makeReservation()" />
    </div>
    } }
    @if (loading) {
    <div class="flex flex-col gap-3 justify-center items-center">
      <h2 class="text-lg text-gray-600">Cargando lista de reservas, espere un momento...</h2>
    </div>
    } @else {
    @if (reservationList.length > 0) {
    <div class="grid gap-3" [ngClass]="
        listOfDetailsField ? 'grid-cols-1' : 'lg:grid-cols-3 md:grid-cols-2 grid-cols-1'
      ">
      @for (reservation of reservationList; track reservation.id) {
        <article
          class="rounded-2xl shadow hover:shadow-lg transition-all p-5 space-y-4 bg-white border border-gray-100 relative animate-slide-down">
          <!-- Cabecera -->
          <div class="flex justify-between items-start">
            <div class="space-y-1">
              <p class="text-xs text-gray-400 uppercase font-medium tracking-wide">
                {{ reservationBy == 'field' || fromDetail == 'field' ? 'Equipo' : 'Cancha' }}
              </p>
              <h2 class="text-base font-semibold text-primary truncate">
                {{
                reservationBy == 'field' || fromDetail == 'field'
                ? reservation.team?.name || 'Sin equipo asignado'
                : reservation.field?.name || 'Sin cancha asignada'
                }}
              </h2>
            </div>
        
            <span class="text-xs font-semibold px-3 py-1 rounded-full text-nowrap border truncate" [ngClass]="{
                      'bg-green-50 text-green-700 border-green-200': reservation.status === StatusReservation.ACTIVE,
                      'bg-gray-50 text-gray-700 border-gray-300': reservation.status === StatusReservation.FINISHED,
                      'bg-red-50 text-red-700 border-red-200': reservation.status === StatusReservation.CANCELED
                    }">
              {{ reservation.status | statusReservation }}
            </span>
          </div>
        
          <!-- Detalles -->
          <div class="text-sm text-gray-600">
            <p>
              <span class="font-medium text-gray-800">Fecha:</span>
              {{ isReservationToday(reservation) }}
            </p>
            <p>
              <span class="font-medium text-gray-800">Hora:</span>
              {{ reservation.startTime | timeFormat }} - {{ reservation.endTime | timeFormat }}
            </p>
          </div>
        
          <!-- Estado dinámico -->
          <div *ngIf="reservation.status === StatusReservation.ACTIVE">
            <p class="text-xs font-medium" [ngClass]="{
                      'text-red-500': isReservationExpired(reservation),
                      'text-yellow-600': getReservationStatus(reservation) === 'upcoming',
                      'text-green-600': isInProgressAndActive(reservation)
                    }">
              {{
              isReservationExpired(reservation)
              ? 'La reserva ha superado su hora final. Debe finalizarse.'
              : getReservationStatus(reservation) === 'upcoming'
              ? 'Empieza pronto.'
              : isInProgressAndActive(reservation)
              ? 'En curso.'
              : ''
              }}
            </p>
          </div>
        
          <!-- Botones -->
          <div *ngIf="showButtons(reservation)" class="pt-2">
            @switch(getReservationStatus(reservation)) {
            @case('upcoming') {
            <button-action text="Cancelar reserva" color="red" title="Cancelar esta reserva"
              (clicked)="cancelReservation(reservation.id, reservation.team?.name)" />
            }
            @case('expired') {
            <button-action text="Finalizar reserva" color="black" title="Finalizar esta reserva"
              (clicked)="finalizeReservation(reservation.id, reservation.team?.name)" />
            }
            @case('inProgress') {
            @if (reservationBy == 'field') {
            <button-action text="Finalizar reserva" color="black" title="Finalizar esta reserva"
              (clicked)="finalizeReservation(reservation.id, reservation.team?.name)" />
            }
            }
            @case('other') {
            <button-action text="Cancelar reserva" color="red" title="Cancelar esta reserva"
              (clicked)="cancelReservation(reservation.id, reservation.team?.name)" />
            }
            }
          </div>
        </article>
      }
    </div>
    } @else {
    <p class="text-gray-600" [ngClass]="{ 'px-3': !listOfDetailsField }">
      No tienes reservas hasta el momento.
    </p>
    }
    }
  </div>
</section>